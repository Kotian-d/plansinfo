<!DOCTYPE html>
<html>
  <head>
    <title>DTH Plans - Multi Period Amounts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CDN for styling -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
      <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <%- include('partials/navbar') %>

    <section class="container" style="margin-top: 40px">
      <% if (error) { %>
      <div
        class="alert alert-danger alert-dismissible"
        role="alert"
        style="margin-top: 16px"
      >
        <button
          type="button"
          class="close"
          data-dismiss="alert"
          aria-label="Close"
        >
          &times;
        </button>
        <%= error %>
      </div>
      <% } %> <% if (message) { %>
      <div class="alert alert-success alert-dismissible" role="alert">
        <button
          type="button"
          class="close"
          data-dismiss="alert"
          aria-label="Close"
        >
          &times;
        </button>
        <%= message %>
      </div>
      <% } %>

      <h2 class="text-center">Prepaid Plans</h2>

      <!-- CSV Import Section -->
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Import from CSV</h3>
        </div>
        <div class="panel-body">
          <form
            method="POST"
            action="/prepaidplans/uploadcsv"
            enctype="multipart/form-data"
          >
            <div class="form-group">
              <label for="csv">Select CSV file</label>
              <input
                class="form-control"
                id="csv"
                name="csvfile"
                type="file"
                accept=".csv"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">Upload CSV</button>
          </form>
        </div>
      </div>
      <!-- End CSV Import Section -->

      <!-- Existing Add Entry Form -->
      <div class="panel panel-default" style="margin-top: 40px">
        <div class="panel-heading">
          <h3 class="panel-title">
            <a
              data-toggle="collapse"
              href="#addEntryForm"
              aria-expanded="false"
              aria-controls="addEntryForm"
              style="display: block; text-decoration: none"
            >
              Add New Prepaid Plan Entry <span class="caret"></span>
            </a>
          </h3>
        </div>
        <div id="addEntryForm" class="panel-collapse collapse">
          <div class="panel-body">
            <form method="POST" action="/prepaidplans/add">
              <div class="form-group">
                <label for="title">Title</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  class="form-control"
                  required
                />
              </div>

              <div class="form-group">
                <label for="description">Description</label>
                <textarea
                  id="description"
                  name="description"
                  class="form-control"
                  rows="3"
                  required
                ></textarea>
              </div>

              <div class="form-group">
                <label for="validity">Validity</label>
                <input
                  type="text"
                  id="validity"
                  name="validity"
                  class="form-control"
                  placeholder="e.g., 1 Month"
                  required
                />
              </div>

              <div class="form-group">
                <label>Select Operator</label>
                <select class="form-control" name="operator" required>
                  <option value="" disabled selected>Select Operator</option>
                  <% if (operators && operators.length) { %> <%
                  operators.forEach(function(op) { %>
                  <option value="<%= op._id %>"><%= op.name %></option>
                  <% }) %> <% } %>
                </select>
              </div>

              <div class="form-group">
                <label for="amount">Amount</label>
                <input
                  type="number"
                  step="0.01"
                  id="amount"
                  name="amount"
                  class="form-control"
                  required
                />
              </div>

              <div class="form-group">
                <label for="tags">Tags</label>
                <select
                  id="tags"
                  name="tags"
                  class="form-control select2-multi"
                  multiple="multiple"
                  required
                >
                  <% if (tagsList && tagsList.length) {
                  tagsList.forEach(function(tag) { %>
                  <option value="<%= tag._id %>"><%= tag.name %></option>
                  <% }) } %>
                </select>
              </div>

              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          </div>
        </div>
      </div>

      <input
        type="text"
        id="prepaidtableFilterInput"
        class="form-control"
        placeholder="Search any field..."
        style="margin-bottom: 16px"
        onkeyup="filterTable()"
      />

      <% if (entries && entries.length) { %>
      <table
        id="resultsTable"
        class="table table-bordered table-striped"
        style="margin-top: 30px"
      >
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Validity (days)</th>
            <th>Operator</th>
            <th>Amount</th>
            <th>Tags</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <% entries.forEach(record => { %>
          <tr>
            <td><%= record.title %></td>
            <td><%= record.description %></td>
            <td><%= record.validity %></td>
            <td><%= record.operator.name %></td>
            <td><%= record.amount %></td>
            <td>
              <% if (record.tags && record.tags.length) {
              record.tags.forEach(function(tag) { %>
              <span class="badge bg-primary"><%= tag.name %></span>
              <% }) } %>
            </td>
            <td>
              <a
                href="/prepaidplans/edit/<%= record._id %>"
                class="btn btn-sm btn-warning"
                >Edit</a
              >
              <form
                action="/prepaidplans/delete/<%= record._id %>"
                method="POST"
                style="display: inline"
              >
                <button
                  type="submit"
                  class="btn btn-sm btn-danger"
                  onclick="return confirm('Delete this entry?');"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>

      <%- include('partials/pagination') %> <% } %>
    </section>

<%- include('partials/footer') %>
