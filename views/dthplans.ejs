<!DOCTYPE html>
<html>
  <head>
    <title>DTH Plans - Multi Period Amounts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CDN for styling -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <%- include('partials/navbar') %>
    <div class="container" style="margin-top: 40px">
      <% if (successMsg && successMsg.length >
    0) { %>
    <div class="alert alert-success alert-dismissible" role="alert">
      <button
        type="button"
        class="close"
        data-dismiss="alert"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button>
      <%= successMsg %>
    </div>
    <% } %> <% if (errorMsg && errorMsg.length > 0) { %>
    <div class="alert alert-danger alert-dismissible" role="alert">
      <button
        type="button"
        class="close"
        data-dismiss="alert"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button>
      <%= errorMsg %>
    </div>
    <% } %>
      
      <h2 class="text-center">DTH Plans</h2>

      <!-- Import from CSV Section -->
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Import from CSV</h3>
        </div>
        <div class="panel-body">
          <form
            method="POST"
            action="/dthplans/uploadcsv"
            enctype="multipart/form-data"
          >
            <div class="form-group">
              <label for="csv">Select CSV file</label>
              <input
                class="form-control"
                id="csv"
                name="csvfile"
                type="file"
                accept=".csv"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">Upload CSV</button>
          </form>
        </div>
      </div>

      <!-- Add Entry Section -->
      <div class="panel panel-default" style="margin-top: 40px">
        <div class="panel-heading">
          <h3 class="panel-title">
            <a
              data-toggle="collapse"
              href="#addEntryForm"
              aria-expanded="false"
              aria-controls="addEntryForm"
              style="display: block; text-decoration: none"
            >
              Add New DTH Plan Entry <span class="caret"></span>
            </a>
          </h3>
        </div>
        <div id="addEntryForm" class="panel-collapse collapse">
          <div class="panel-body">
            <form method="POST" action="/dthplans/add">
              <div class="form-group">
                <label for="title">Title</label>
                <input
                  class="form-control"
                  id="title"
                  name="title"
                  type="text"
                  required
                />
              </div>
              <div class="form-group">
                <label for="description">Description</label>
                <textarea
                  class="form-control"
                  id="description"
                  name="description"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="form-group">
                <label>Select Operator</label>
                <select class="form-control" name="operator" required>
                  <option value="" disabled selected>Select Operator</option>
                  <% if (operators && operators.length) { %> <%
                  operators.forEach(function(op) { %>
                  <option value="<%= op._id %>"><%= op.name %></option>
                  <% }) %> <% } %>
                </select>
              </div>
              <div class="form-group">
                <label for="amount1month">Amount (1 Month)</label>
                <input
                  class="form-control"
                  id="amount1month"
                  name="amount1month"
                  type="number"
                  step="0.01"
                  required
                />
              </div>
              <div class="form-group">
                <label for="amount3month">Amount (3 Months)</label>
                <input
                  class="form-control"
                  id="amount3month"
                  name="amount3month"
                  type="number"
                  step="0.01"
                  required
                />
              </div>
              <div class="form-group">
                <label for="amount6month">Amount (6 Months)</label>
                <input
                  class="form-control"
                  id="amount6month"
                  name="amount6month"
                  type="number"
                  step="0.01"
                  required
                />
              </div>
              <div class="form-group">
                <label for="amount12month">Amount (12 Months)</label>
                <input
                  class="form-control"
                  id="amount12month"
                  name="amount12month"
                  type="number"
                  step="0.01"
                  required
                />
              </div>
              <button type="submit" class="btn btn-success btn-block">
                Submit
              </button>
            </form>
          </div>
        </div>
      </div>

      <input
        type="text"
        id="dthTableFilterInput"
        class="form-control"
        placeholder="Search any field..."
        style="margin-bottom: 16px"
        onkeyup="filterTable()"
      />

      <!-- Entries Section -->
      <% if (entries && entries.length) { %>
      <hr />
      <h3 class="text-center">Entries</h3>
      <div class="table-responsive">
        <table id="resultsTable" class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>Title</th>
              <th>Description</th>
              <th>Operator</th>
              <th>Amount (1M)</th>
              <th>Amount (3M)</th>
              <th>Amount (6M)</th>
              <th>Amount (12M)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="dthtableBody">
            <% entries.forEach(function(entry) { %>
            <tr>
              <td><%= entry.title %></td>
              <td><%= entry.description %></td>
              <td><%= entry.operator.name %></td>
              <td><%= entry.amount1month %></td>
              <td><%= entry.amount3month %></td>
              <td><%= entry.amount6month %></td>
              <td><%= entry.amount12month %></td>
              <td>
                <a
                  href="/dthplans/edit/<%= entry._id %>"
                  class="btn btn-sm btn-warning"
                  >Edit</a
                >
                <form
                  action="/dthplans/delete/<%= entry._id %>"
                  method="POST"
                  style="display: inline"
                >
                  <button
                    type="submit"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Delete this entry?');"
                  >
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <%- include('partials/pagination') %>
      </div>
      <% } %>
    </div>
  </body>
<%- include('partials/footer') %>
